
type StakingPool @entity {
  id: ID!
  pool_id: String!
  total_share_balance: BigInt!,
  total_staked_balance: BigInt!,
  stakers: [Staker!] @derivedFrom(field: "select_staking_pool")
}

type Staker @entity {
  id: ID!
  staker_id: String!,
  select_staking_pool_id: String,
  select_staking_pool: StakingPool,
  shares: BigInt!,

  bonding_consumer_chain_count: Int!
  bonding_consumer_chains: [StakerAndConsumerChain!] @derivedFrom(field: "staker") ,
  max_bonding_unlock_period: BigInt!,
  unbonding_unlock_time: BigInt!,
}

enum ValidatorStatus {
  Deployed,
  Staking,
  Unstaking,
  ToBeDestroyed
  Destroyed
}

type Validator @entity {
  id: ID!
  validator_id: String!
  escrow_id: String!
  total_staked_balance: BigInt!
  total_share_balance: BigInt!
  share_balance: BigInt!
  staked_balance: BigInt!
  staker: Staker
  status: ValidatorStatus!
  unstake_withdraw_certificate: Withdrawal

  delegator_count:Int!
  delegator_list_string: String!
  delegators: [Delegator!]! @derivedFrom(field: "select_validator")
  
  rewards: [ValidatorReward!] @derivedFrom(field: "validator")
}

type ValidatorReward @entity {
  id: ID!
  validator: Validator!
  reward_token_id: String!
  reward_token_amount: BigInt!
}

type Delegator @entity {
	id: ID!
  delegator_id: String!
  select_validator: Validator
  share_balance: BigInt!
  staked_balance: BigInt!
  rewards: [DelegatorReward!] @derivedFrom(field: "delegator")
}

type DelegatorReward @entity {
  id: ID!
  delegator: Delegator
  reward_token_id: String!
  reward_token_amount: BigInt!
}

type Sponsor @entity {
  id: ID!
  total_sponsor_amount: BigInt!
  sponsor_consumer_chain_count: Int!
  sponsor_consumer_chains: [SponsorAndConsumerChain!] @derivedFrom(field: "sponsor") ,
  rewards: [SponsorReward!] @derivedFrom(field: "sponsor")
  unsponsor_record: [UnsponsorRecord!] @derivedFrom(field: "sponsor")
}

type SponsorReward @entity {
  id: ID!
  sponsor: Sponsor!
  reward_token_id: String!
  reward_token_amount: BigInt!
}

type ConsumerChain @entity {
  id: ID!
  consumer_chain_id: String!,
  unbond_period: BigInt!,
  website: String!,
  governance: String!,
  treasury: String!,
  status: String!,
  pos_account_id: String!,
  register_fee: BigInt!,
  stakers: [StakerAndConsumerChain!] @derivedFrom(field: "consumer_chain")
}

type StakerAndConsumerChain @entity {
  id: ID!
  staker: Staker!
  consumer_chain: ConsumerChain!
  key: String!
}

type SponsorAndConsumerChain @entity {
  id: ID!
  sponsor: Sponsor!
  consumer_chain: ConsumerChain!
  unlock_time: BigInt
  sponsor_amount: BigInt!
  is_sponsoring: Boolean! 
}

enum SlashStatus {
  Pending,
  Rejected,
  Approved,
}

type Slash @entity {
  id: ID!
  consumer_chain_id: String!,
  slash_items: String!,
  evidence_sha256_hash: String!
  status: SlashStatus! 
}

type Summary @entity {
  id: ID!
  chain_count: Int!
  staker_count: Int!
  validator_count: Int!
  delegator_count: Int!
  total_staked_near: BigInt!
  staking_pool_list: String!
}

enum WithdrawalStatus {
  Pending,
  Withdrawn,
}

type Withdrawal @entity {
  id: ID!

  staker: Staker!
  
  withdrawal_certificate: String!
  pool_id: String!
  amount: BigInt!
  unlock_epoch: BigInt!
  unlock_time: BigInt!
  beneficiary: String!
  validator_id: String

  create_action: UserAction!
  withdraw_action: WithdrawAction

  status: WithdrawalStatus!
  
}

type UnsponsorRecord @entity {
  id: ID!
  sponsor: Sponsor!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt!
  unlock_time: BigInt!
  is_withdraw: Boolean! 

  create_action: UserAction!
  withdraw_action: UserAction
}

enum ActionType {

  # staking pool
  ping_action,

  # staker
  staker_stake_action,
  staker_increase_stake_action,
  staker_decrease_stake_action,
  staker_unstake_action,

  staker_bond_action,
  staker_unbond_action,
  staker_chang_key_action,

  # validator
  deploy_action,
  stake_action,
  increase_stake_action,
  decrease_stake_action,
  unstake_action,

  withdraw_unstake_action,
  destroy_action,
  validator_ping_action,

  # cc gov
  register_consumer_chain_action,
  update_consumer_chain_action,
  deregister_consumer_chain_action,
  request_slash_action

  # delegator
  delegate_action,
  increase_delegation_action,
  decrease_delegation_action,
  undelegate_action,
  undelegate_in_unstake_action

  # validator & delegator
  withdraw_action,
  delegator_receive_reward_action,
  validator_receive_reward_action,

  delegator_claim_reward_action,
  validator_claim_reward_action,

  # sponsor
  sponsor_action,
  increase_sponsorship_action,
  decrease_sponsorship_action,
  unsponsor_action,

  sponsor_receive_reward_action,
  sponsor_claim_reward_action,
  withdraw_unsponsor_action,


  #registry 
  register_consumer_chain_in_lpos_market_action,
  
}

type UserAction @entity {
  id: ID!

  predecessor_id: String!
	signer_id: String!
	user_id: String!
	timestamp: BigInt!
	timestamp_plus_log_index: BigInt!
	receipt_id: String!
  block_height: BigInt!

  action_type: ActionType!

   # staking pool
  ping_action: PingAction,
  
  #staker
  staker_stake_action: StakerStakeAction,
  staker_increase_stake_action: StakerIncreaseStakeAction,
  staker_decrease_stake_action: StakerDecreaseStakeAction,
  staker_unstake_action: StakerUnstakeAction,

  staker_bond_action: StakerBondAction,
  staker_unbond_action: StakerUnbondAction,
  staker_change_key_action: StakerChangeKeyAction,

  # cc gov
  register_consumer_chain_action: RegisterConsumerChainAction,
  update_consumer_chain_action: UpdateConsumerChainAction,
  deregister_consumer_chain_action: DeregisterConsumerChainAction,
  request_slash_action: RequestSlashAction,

  # validator
  deploy_action: DeployAction
  stake_action: StakeAction
  increase_stake_action: IncreaseStakeAction
  decrease_stake_action: DecreaseStakeAction
  unstake_action: UnstakeAction
  destroy_action: DestroyAction


  restake_action: RestakeAction
  unrestake_action: UnrestakeAction
  change_key_action: ChangeKeyAction

  validator_ping_action: ValidatorPingAction

  # delegator
  delegate_action: DelegateAction
  increase_delegation_action: IncreaseDelegationAction
  decrease_delegation_action: DecreaseDelegationAction
  undelegate_action: UndelegateAction
  undelegate_in_unstake_action: UndelegateInUnstakeAction

  # validator & delegator
  withdraw_action: WithdrawAction,
  withdraw_unstake_action: WithdrawUnstakeAction,

  delegator_receive_reward_action: DelegatorReceiveRewardAction,
  validator_receive_reward_action: ValidatorReceiveRewardAction,

  delegator_claim_reward_action: DelegatorClaimRewardAction,
  validator_claim_reward_action: ValidatorClaimRewardAction,

  # sponsor
  sponsor_action: SponsorAction,
  increase_sponsorship_action: IncreaseSponsorshipAction,
  decrease_sponsorship_action: DecreaseSponsorshipAction,
  unsponsor_action: UnsponsorAction,
  withdraw_unsponsor_action: WithdrawUnsponsorAction,

  sponsor_receive_reward_action: SponsorReceiveRewardAction,
  sponsor_claim_reward_action: SponsorClaimRewardAction,

  # registry
  register_consumer_chain_in_lpos_market_action: RegisterConsumerChainInLposMarketAction,
}

type SponsorAction @entity {
  id: ID!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt! 
  sequence: BigInt!
}

type IncreaseSponsorshipAction @entity {
  id: ID!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt! 
  sequence: BigInt!

} 

type DecreaseSponsorshipAction @entity {
  id: ID!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt! 
  sequence: BigInt!
  unlock_time: BigInt!

  unsponsor_record: UnsponsorRecord!
}

type UnsponsorAction @entity {
  id: ID!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt! 
  sequence: BigInt!
  unlock_time: BigInt!

  unsponsor_record: UnsponsorRecord!
}

type WithdrawUnsponsorAction @entity {
  id: ID!
  sponsor_id: String!
  consumer_chain_id: String!
  amount: BigInt!
  unsponsor_record_id: String!
  unsponsor_record: UnsponsorRecord!
}

type SponsorReceiveRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt!
  receiver: String!
}

type SponsorClaimRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt!
  receiver: String!
}

type PingAction @entity {
  id: ID!
  pool_id: String!
  balance: BigInt!
}

type StakerStakeAction @entity {
  id: ID!
  pool_id: String!
  amount: BigInt!
	shares: BigInt!,
	sequence: BigInt!
}

type StakerIncreaseStakeAction @entity {
  id: ID!
  amount: BigInt!
	shares: BigInt!,
	sequence: BigInt!
}

type StakerDecreaseStakeAction @entity {
  id: ID!
  amount: BigInt!,
	shares: BigInt!,
	withdrawal: Withdrawal!,
	sequence: BigInt!,
}

type StakerUnstakeAction @entity {
  id: ID!
  amount: BigInt!,
	shares: BigInt!,
	withdrawal: Withdrawal!,
	sequence: BigInt!
}

type StakerBondAction @entity {
  id: ID!
  staker_id: String!
  consumer_chain_id: String!
  key: String!
}

type StakerUnbondAction @entity {
  id: ID!
  staker_id: String!
  consumer_chain_id: String!
}

type StakerChangeKeyAction @entity {
  id: ID!
  staker_id: String!
  consumer_chain_id: String!
  old_key: String!
  new_key: String!
}

type ValidatorPingAction @entity {
  id: ID!
  validator_id: String!,
  balance: BigInt!
}

type RegisterConsumerChainAction @entity {
  id: ID!
  param: String!
}


type RegisterConsumerChainInLposMarketAction @entity {
  id: ID!
  consumer_chain_id: String!
  anchor_id: String!
}

type UpdateConsumerChainAction @entity {
  id: ID!
  param: String!
}

type DeregisterConsumerChainAction @entity {
  id: ID!

}

type RequestSlashAction @entity {
  id: ID!
  slash: Slash!
  consumer_chain_id: String!
  slash_items: String!
  evidence_sha256_hash: String!
}

type DeployAction @entity {
  id: ID!
  escrow_id: String!
  deploy_fee: BigInt!
}

type StakeAction @entity {
  id: ID!
  pool_id: String!
  amount: BigInt!
  shares: BigInt!
  validator_id: String!
}

type IncreaseStakeAction @entity {
  id: ID!
  amount: BigInt! 
  shares: BigInt!
  validator_id: String!
}

type DecreaseStakeAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  sequence: BigInt!
  staker_decrease_stake_action: StakerDecreaseStakeAction!
  withdrawal: Withdrawal!
  validator_id: String!
}

type UnstakeAction @entity {
  id: ID!
  withdrawal: Withdrawal!
  sequence: BigInt!
  staker_unstake_action: StakerUnstakeAction
  validator_id: String!
}

type DestroyAction @entity {
  id: ID!
  amount: BigInt!
  validator_id: String!
}

type RestakeAction @entity {
  id: ID!
  consumer_chain_id: String!
  key: String!
}

type UnrestakeAction @entity {
  id: ID!
  consumer_chain_id: String!
}

type ChangeKeyAction @entity {
  id: ID!
  consumer_chain_id: String!
  key: String!
}

type DelegateAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  validator_id: String!
}

type IncreaseDelegationAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  validator_id: String!
}

type DecreaseDelegationAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  sequence: BigInt!
  validator_id: String!
  staker_decrease_stake_action: StakerDecreaseStakeAction!
  withdrawal: Withdrawal!
}

type UndelegateAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  sequence: BigInt!
  validator_id: String!
  staker_decrease_stake_action: StakerDecreaseStakeAction!
  withdrawal: Withdrawal!
}

type UndelegateInUnstakeAction @entity {
  id: ID!
  amount: BigInt!
  shares: BigInt!
  validator_id: String!
}

type WithdrawAction @entity{
  id: ID!
  withdrawal_certificate: String!
  amount: BigInt!
  withdrawal: Withdrawal!
}

type WithdrawUnstakeAction @entity {
  id: ID!
  withdrawal_certificate: String!
  amount: BigInt!
  withdrawal: Withdrawal!
  validator_id: String!
}

type DelegatorReceiveRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt!
  receiver: String!
  validator_id: String!
}

type ValidatorReceiveRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt!
  receiver: String!
}

type DelegatorClaimRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt
  receiver: String!
}

type ValidatorClaimRewardAction @entity {
  id: ID!
  token_id: String!
  amount: BigInt
  receiver: String!
}